@using AdvertisingAgency.ViewModels
@model OrderViewModel
@inject SignInManager<AdvertisingAgency.Models.User> SignInManager
@inject UserManager<AdvertisingAgency.Models.User> UserManager
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper "*, AdvertisingAgency"
@{
    ViewData["Title"] = "Orders";

}
<img src="~/images/images.jpg" />
<h1>Заказы</h1>

@using (Html.BeginForm("Order", "Order", FormMethod.Get))
{
    <p>
        <label>Дата Договора</label>
        @Html.TextBox("DateOrder")
        <filter></filter>
    </p>
}

<table>
    <tr>
        <th>
            <a asp-action="Order" asp-route-sortOrder="@ViewBag.CustOrderSort">
                Заказчик
            </a>
        </th>
        <th>
            <a asp-action="Order" asp-route-sortOrder="@ViewBag.AdvPeriodSort">
                Вид рекламы
            </a>
        </th>
        <th>
            <a asp-action="Order" asp-route-sortOrder="@ViewBag.DateOrderSort">
                Дата заключения договора
            </a>
        </th>
        <th>
            <a asp-action="Order" asp-route-sortOrder="@ViewBag.OrderPeriodSort">
                Срок действия
            </a>
        </th>
        <th>
            <a asp-action="Order" asp-route-sortOrder="@ViewBag.OrderLocationSort">
                Место расположения
            </a>
        </th>
        <th>
            <a asp-action="Order" asp-route-sortOrder="@ViewBag.OrderCostSort">
                Цена услуги
            </a>
        </th>
        <th class="act">
            <span>Действие</span>
        </th>
    </tr>
    @foreach (var item in Model.Orders)
    {
        List<Advedirsments> advedirsments = (List<Advedirsments>)ViewBag.advedirsments;
        string adv = "";
        foreach (var ad in advedirsments)
        {
            if (item.AdvedirsmentsId == ad.AdvedirsmentsId)
            {
                adv = ad.AdType;
            }
        }
        List<Customers> customers = (List<Customers>)ViewBag.customers;
        string cust = "";
        foreach (var c in customers)
        {
            if (item.CustomersId == c.CustomersId)
            {
                cust = c.CustomerName;
            }
        }
        <tr>
            <td>@cust</td>
            <td>@adv</td>
            <td>@item.DateOrder.ToShortDateString()</td>
            <td>@item.DateBegin.ToShortDateString() - @item.DateEnd.ToShortDateString()</td>
            <td>@item.Location</td>
            <td>@item.OrderCost</td>
            <td class="act">
                <form asp-action="Delete" asp-route-id="@item.OrdersId" method="post">
                    <a class="btn btn-sm btn-primary" asp-action="Edit" asp-route-id="@item.OrdersId">Изменить</a>
                    <button type="submit" class="btn btn-sm btn-danger">
                        Удалить
                    </button>
                </form>
            </td>
        </tr>
    }
</table>


@if (Model.PageViewModel.HasPreviousPage)
{
    <a asp-action="Order"
       asp-route-page="@(Model.PageViewModel.PageNumber - 1)"
       class="btn btn-default btn">
        <i class="glyphicon glyphicon-chevron-left"></i>
        Назад
    </a>
}

@if (Model.PageViewModel.HasNextPage)
{
    <a asp-action="Order"
       asp-route-page="@(Model.PageViewModel.PageNumber + 1)"
       class="btn btn-default btn">
        Вперед
        <i class="glyphicon glyphicon-chevron-right"></i>
    </a>
}

@{
    AdvertisingAgency.Models.Orders orderSession =
        (AdvertisingAgency.Models.Orders)ViewBag.orderSession;
}

@if (SignInManager.IsSignedIn(User))
{
    @using (Html.BeginForm("AddOrder", "Order", FormMethod.Post))
    {
        <div asp-validation-summary="ModelOnly"></div>
        <p>
            <label>Заказчик</label>
            <select asp-for="orders.CustomersId">
                    {
                    @{
                        List<Customers> customers = (List<Customers>)ViewBag.customers;
                        foreach (var item in customers)
                        {
                            if (orderSession != null && orderSession.OrdersId == item.CustomersId)
                            {
                                <option asp-for="orders.CustomersId" value=@item.CustomersId selected>@item.CustomerName</option>
                            }
                            else
                            {
                                <option asp-for="orders.CustomersId" value=@item.CustomersId>@item.CustomerName</option>
                            }
                        }
                    }
                    }
                </select>
        </p>
        <p>


            <label asp-for="orders.AdvedirsmentsId">Вид рекламы</label>
            <select asp-for="orders.AdvedirsmentsId">
                {
                @{
                    List<Advedirsments> advedirsments = (List<Advedirsments>)ViewBag.advedirsments;
                    foreach (var item in advedirsments)
                    {
                        if (orderSession != null && orderSession.AdvedirsmentsId == item.AdvedirsmentsId)
                        {
                            <option asp-for="orders.AdvedirsmentsId" value=@item.AdvedirsmentsId selected>@item.AdType</option>
                        }
                        else
                        {
                            <option asp-for="orders.AdvedirsmentsId" value=@item.AdvedirsmentsId>@item.AdType</option>
                        }
                    }
                }
                }
            </select>
        </p>
        <p>
            <label>Дата заказа</label>
            @{
                if (orderSession != null)
                {
                    @Html.TextBox("DateOrder", orderSession.DateOrder);
                }
                else
                {
                    @Html.TextBox("DateOrder");
                }
            }

        </p>
        <p>
            <label>Дата начала</label>
            @{
                if (orderSession != null)
                {
                    @Html.TextBox("DateBegin", orderSession.DateBegin);
                }
                else
                {
                    @Html.TextBox("DateBegin");
                }
            }
        </p>
        <p>
            <label>Конец</label>
            @{
                if (orderSession != null)
                {
                    @Html.TextBox("DateEnd", orderSession.DateEnd);
                }
                else
                {
                    @Html.TextBox("DateEnd");
                }
            }
        </p>
        <p>
            <label>Место расположения</label>
            @{
                if (orderSession != null)
                {
                    @Html.TextBox("Location", orderSession.Location);
                }
                else
                {
                    @Html.TextBox("Location");
                }
            }
        </p>
        <p>
            <label>Цена услуги</label>
            @{
                if (orderSession != null)
                {
                    @Html.TextBox("OrderCost", orderSession.OrderCost);
                }
                else
                {
                    @Html.TextBox("OrderCost");
                }
            }
        </p>
        <p>
            <input type="submit" value="Send">
        </p>
    }
}

